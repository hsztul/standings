<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>mlb_standings</title>
  <style>
    /* ==== RESET & BASIC TYPOGRAPHY ==== */
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background-color: #f9f9f9;
      color: #333;
      line-height: 1.4;
    }
    h1 {
      margin: 0;
      padding: 1rem;
      font-size: 1.25rem;
      background-color: #fff;
      text-align: center;
      border-bottom: 1px solid #ddd;
    }
    /* ==== TAB BAR ==== */
    .tabs {
      display: flex;
      overflow-x: auto;
      background-color: #fff;
      border-bottom: 1px solid #ddd;
    }
    .tab {
      flex: 0 0 auto;
      padding: 0.75rem 1rem;
      font-size: 0.9rem;
      color: #555;
      text-align: center;
      cursor: pointer;
      white-space: nowrap;
      border-bottom: 3px solid transparent;
    }
    .tab.active {
      color: #000;
      border-bottom-color: #000;
      font-weight: bold;
    }
    /* ==== TABLE STYLE ==== */
    .standings-container {
      padding: 0 1rem 2rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background-color: #fff;
      margin-top: 1rem;
    }
    th, td {
      padding: 0.75rem 0.5rem;
      text-align: left;
      font-size: 0.9rem;
      border-bottom: 1px solid #eee;
    }
    th {
      background-color: #fafafa;
      font-weight: 600;
      position: sticky;
      top: 0;
      z-index: 1;
    }
    tr:last-child td {
      border-bottom: none;
    }
    /* ==== MOBILE ADJUSTMENTS ==== */
    @media (max-width: 400px) {
      th, td {
        font-size: 0.8rem;
        padding: 0.6rem 0.4rem;
      }
      .tab {
        padding: 0.6rem 0.8rem;
        font-size: 0.8rem;
      }
      h1 {
        font-size: 1.1rem;
        padding: 0.8rem;
      }
    }
    /* ==== LOADING & ERROR STATES ==== */
    .loading,
    .error {
      text-align: center;
      padding: 1.5rem;
      color: #666;
    }
    .error {
      color: #c00;
    }
  </style>
</head>
<body>
  <h1>MLB Standings: NL East</h1>

  <!-- Division tabs (NL East default) -->
  <div class="tabs" id="division-tabs">
    <div class="tab active" data-division="NL East">NL East</div>
    <div class="tab" data-division="NL Central">NL Central</div>
    <div class="tab" data-division="NL West">NL West</div>
    <div class="tab" data-division="AL East">AL East</div>
    <div class="tab" data-division="AL Central">AL Central</div>
    <div class="tab" data-division="AL West">AL West</div>
  </div>

  <!-- Container for the standings table or loading/error message -->
  <div class="standings-container" id="standings-container">
    <div class="loading">Loading NL East…</div>
  </div>

  <script>
    // We’ll route through a public CORS proxy so we can fetch the MLB.com page from any static host
    const PROXY_URL   = "https://api.allorigins.win/raw?url=";
    const MLB_URL     = "https://www.mlb.com/standings/";

    // Exact division names as they appear in MLB.com’s plain-text (after stripping tags):
    const DIVISIONS = [
      "AL East",
      "AL Central",
      "AL West",
      "NL East",
      "NL Central",
      "NL West"
    ];

    // Cache the raw HTML string (so clicking tabs repeatedly doesn't re-fetch)
    let htmlCache = null;

    /**
     * 1) Fetches the entire MLB.com/standings page (via proxy).
     * 2) Caches the result in `htmlCache` and returns raw HTML text.
     */
    async function fetchStandingsPage() {
      if (htmlCache !== null) {
        return htmlCache;
      }
      const resp = await fetch(PROXY_URL + encodeURIComponent(MLB_URL));
      if (!resp.ok) {
        throw new Error("Failed to fetch MLB.com standings page.");
      }
      htmlCache = await resp.text();
      return htmlCache;
    }

    /**
     * Parses out W, L, PCT, GB, and Next Game for the specified divisionKey.
     *
     * Strategy (:contentReference[oaicite:0]{index=0}):
     *  • Load the full HTML, run it through a DOMParser.
     *  • Grab `doc.body.textContent`, split by newline, trim & filter empty lines.
     *  • Find the index of the line that exactly equals e.g. “NL East”.
     *  • Find where the next division header appears (or end of list).
     *  • In between, skip the column‐header line(s) (those containing “W L PCT GB”).
     *  • What remains are chunks of three lines per team:
     *      [team name] → [stats line, from which we take wins, losses, pct, gb] → [next game line].
     *  • Build an array of objects `{team, wins, losses, pct, gb, nextGame}`.
     */
    async function getDivisionData(divisionKey) {
      const rawHtml = await fetchStandingsPage();
      // Parse into a temporary document just to extract plain text
      const parser = new DOMParser();
      const doc = parser.parseFromString(rawHtml, "text/html");
      const allText = doc.body.textContent || "";
      // Split on newlines and clean up
      const lines = allText
        .split("\n")
        .map(l => l.trim())
        .filter(l => l !== "");

      // 1) Locate the exact line “divisionKey” (e.g. “NL East”)
      const startIdx = lines.indexOf(divisionKey);
      if (startIdx < 0) {
        throw new Error(`Could not find division header “${divisionKey}” in scraped text.`);
      }
      // 2) Find where the next division header appears (or end)
      let endIdx = lines.length;
      for (let i = startIdx + 1; i < lines.length; i++) {
        if (DIVISIONS.includes(lines[i])) {
          endIdx = i;
          break;
        }
      }
      // 3) Extract that slice; skip the very first line (which is “NL East”), so slice from startIdx+1
      const rawSection = lines.slice(startIdx + 1, endIdx);

      // 4) Filter out any line that looks like the column‐header:
      //    those will always contain “W L PCT GB”
      const filtered = rawSection.filter(line => !/W\s+L\s+PCT\s+GB/.test(line));

      // 5) Now, “filtered” should look like:
      //    [
      //      "New York Yankees",
      //      "36 22 .621 -- …",     ← stats line
      //      "Jun 3 vs. CLE",       ← next game
      //      "Toronto Blue Jays",
      //      "31 28 .525 5.5 …",
      //      "Jun 3 vs. PHI",
      //      …
      //    ]
      //    i.e. 3 lines per team. We’ll parse every 3‐line group.
      const result = [];
      for (let i = 0; i + 2 < filtered.length; i += 3) {
        const teamName   = filtered[i];
        const statsLine  = filtered[i + 1];
        const nextGame   = filtered[i + 2];

        // Split statsLine on whitespace; first 4 tokens are W, L, PCT, GB
        const statsTokens = statsLine.split(/\s+/);
        const wins  = statsTokens[0] || "";
        const losses= statsTokens[1] || "";
        const pct   = statsTokens[2] || "";
        const gb    = statsTokens[3] || "";

        result.push({
          team: teamName,
          wins,
          losses,
          pct,
          gb,
          nextGame
        });
      }

      return result;
    }

    /**
     * Renders one division’s data into a simple 6‐column table:
     *   Team │ W │ L │ PCT │ GB │ Next Game
     */
    async function renderDivision(divisionKey) {
      const container = document.getElementById("standings-container");
      container.innerHTML = `<div class="loading">Loading ${divisionKey}…</div>`;

      try {
        const data = await getDivisionData(divisionKey);

        // Build a minimal <table>
        const table = document.createElement("table");
        const thead = document.createElement("thead");
        thead.innerHTML = `
          <tr>
            <th>Team</th>
            <th>W</th>
            <th>L</th>
            <th>PCT</th>
            <th>GB</th>
            <th>Next Game</th>
          </tr>
        `;
        table.appendChild(thead);

        const tbody = document.createElement("tbody");
        data.forEach(row => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${row.team}</td>
            <td>${row.wins}</td>
            <td>${row.losses}</td>
            <td>${row.pct}</td>
            <td>${row.gb}</td>
            <td>${row.nextGame}</td>
          `;
          tbody.appendChild(tr);
        });
        table.appendChild(tbody);

        // Replace container’s content
        container.innerHTML = "";
        container.appendChild(table);
      } catch (err) {
        console.error(err);
        container.innerHTML = `<div class="error">Error loading standings for ${divisionKey}.</div>`;
      }
    }

    /**
     * Set up click handlers on each tab:
     *   • Toggle the “active” class
     *   • Update the <h1> to show “MLB Standings: [Division]”
     *   • Call renderDivision(...)
     */
    function setupTabs() {
      const tabs = document.querySelectorAll(".tab");
      tabs.forEach(tab => {
        tab.addEventListener("click", () => {
          tabs.forEach(t => t.classList.remove("active"));
          tab.classList.add("active");

          const divisionKey = tab.getAttribute("data-division");
          document.querySelector("h1").textContent = `MLB Standings: ${divisionKey}`;
          renderDivision(divisionKey);
        });
      });
    }

    // On initial load, show NL East by default
    document.addEventListener("DOMContentLoaded", () => {
      setupTabs();
      renderDivision("NL East");
    });
  </script>
</body>
</html>
